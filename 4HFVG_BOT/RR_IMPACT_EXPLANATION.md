# Пояснення: Чому при збільшенні RR стає більше трейдів

## Проблема
При збільшенні RR (risk-reward) співвідношення з 1.5 до 2, а потім до 3, кількість трейдів збільшується, хоча змінювався тільки RR.

## Аналіз результатів

### Порівняння RR 1.5 vs RR 3.0:
- **RR 1.5**: 80 трейдів, 12.5% закрилися по SL, середній час утримання SL трейдів: 6.7 годин
- **RR 3.0**: 84 трейдів, 22.6% закрилися по SL, середній час утримання SL трейдів: 9.1 годин

## Причина збільшення кількості трейдів

### 1. Більше трейдів закриваються по SL
При збільшенні RR, TP стає далі від entry. Це означає:
- Трейди, які програють, закриваються по SL (більше трейдів)
- Трейди, які виграють, закриваються по TP (менше трейдів, але з більшим прибутком)

**Результат**: При RR 3.0 в 2 рази більше трейдів закриваються по SL (22.6% vs 12.5%)

### 2. Логіка переміщення в часі
У коді (`backtest_failed_fvg.py`, рядки 676-680):
```python
# Jump to end of trade
if fill_idx:
    exit_time = trade.exit_time
    exit_idx = df_15m.index.get_loc(exit_time)
    current_15m_idx = exit_idx
```

**Що відбувається:**
- Коли трейд закривається (особливо по SL), код переміщує `current_15m_idx` до кінця трейду
- Це означає, що після закриття трейду ми "перестрибуємо" через весь час, коли трейд був активний
- Після цього стрибка є більше можливостей для нових трейдів, тому що:
  - Більше часу пройшло = більше 15M FVGs могли сформуватися
  - Більше відхилених 4H FVGs можуть бути оброблені
  - Нові 4H FVGs могли бути відхилені під час утримання попереднього трейду

### 3. Відсутність блокування нових трейдів
У коді є перевірка `if not self.active_trade:`, але `self.active_trade` ніколи не встановлюється. Це означає, що:
- Перевірка завжди проходить
- Технічно нові трейди можуть створюватися навіть під час симуляції попереднього трейду
- Але на практиці це не відбувається через логіку переміщення в часі

## Висновок

**Ваша гіпотеза правильна!** 

При збільшенні RR:
1. Більше трейдів закриваються по SL (12.5% → 22.6%)
2. Кожне закриття по SL призводить до "стрибка" вперед у часі
3. Після кожного стрибка є більше можливостей для нових трейдів
4. Результат: більше трейдів в цілому

## Рекомендації

Якщо ви хочете обмежити кількість трейдів:
1. Додайте логіку для встановлення `self.active_trade` під час створення трейду
2. Не переміщуйте `current_15m_idx` після закриття трейду (або переміщуйте менше)
3. Додайте cooldown після закриття трейду по SL

Але зауважте: більше трейдів не обов'язково погано, якщо вони приносять прибуток!

